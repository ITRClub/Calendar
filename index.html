<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="UTF-8">
	<title>Calendar Test</title>
	
	<!-- include JS File -->
	<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/amazeui/2.7.2/js/amazeui.min.js"></script>
	<script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>

	<!-- include CSS File -->
	<link rel="stylesheet" href="https://cdn.bootcss.com/amazeui/2.7.2/css/amazeui.min.css">
	
	<style>
	*{margin:0;padding:0;}

	body{
		background:white;
	}

	#calendar{
		width:358px;
		margin:0 auto;
		margin-top:2%;
		margin-bottom:2%;
		border-radius:5px;
		font-family:'Open Sans',sans-serif;
		text-align:center;
		color:#555;
		box-shadow:0 0 50px -14px rgba(0,0,0,.8);
		background-color: white;
	}

	#calendar h1{
		margin-bottom: 0px;
		background:#ee3333;
		border-radius:5px 5px 0 0;
		padding:20px;
		text-transform:uppercase;
		letter-spacing:1px;
		color:#fff;
		cursor:default;
		text-shadow:0 0 7px rgba(0,0,0,.8);
	}

	#calendar table{
		width: 358px;
		border-top:1px solid #ddd;
		border-left:1px solid #ddd;
		border-spacing:0;
		border-radius:0 0 5px 5px;
	}

	#calendar td{
		width:38px;
		height:38px;
		background:#eee;
		border-right:1px solid #ddd;
		border-bottom:1px solid #ddd;
		padding:6px;
		cursor:pointer;
		transition:background .3s;
		-webkit-transition:background .3s;
	}

	#calendar td:hover:not(.today){
		background:#ddd;
	}

	#calendar .otherMonth{
		background:#fff;
		color:#999;
	}

	#calendar .today{
		background:#ee3333;
		font-weight:700;
		color:#fff;
		text-shadow:0 0 10px rgba(0,0,0,.5);
	}

	#calendar .haveTask{
		font-weight:bold;
		color: green;
	}
	#calendar tr:last-of-type td:first-of-type{border-radius:0 0 0 5px;}
	#calendar tr:last-of-type td:last-of-type{border-radius:0 0 5px 0;}
</style>
</head>

<body style="padding-top: 10px;">

<!-- 日历框 -->
<div id="calendar">
	<h1 style="font-family: '微软雅黑';"><p id="month"></p></h1>
	<table id="table">
		<tr>
			<td>日</td>
			<td>一</td>
			<td>二</td>
			<td>三</td>
			<td>四</td>
			<td>五</td>
			<td>六</td>
		</tr>
	</table>

	<!-- 邀请词 -->
	<div id="invite" style="display: none;text-align: center;">
		<br>
		<font style="font-size:27px;font-weight:bold;color:#99CCCC;background-color: white;">
			<font id="name_show" color="#003366"></font>在这些天有空哦~<br>
			快来找我玩吧！
		</h1>
	</div>
	<!-- ./邀请词 -->

	<!-- 项目二维码 -->
	<img id="qrcode" style="display: none;" src="data:image/png;base64,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">
	<!-- ./项目二维码 -->

</div>
<!-- ./日历框 -->

<br>

<center>
	<div class="am-input-group" style="width: 95%;">
		<input class="am-form-field" id="name" style="border-radius:5px;">
		<span class="am-input-group-btn">
			<button class="am-btn am-btn-success" id="sureHaveTaskDay_btn" onclick="sureHaveTaskDay()" style="border-radius:5px;">立即生成照片</button>
		</span>
	</div>
</center>

<script>
var date=new Date();
var month=date.getMonth()+1;
var days=[29,30,31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,1,2,3,4];
var haveTaskDays=[];
var showOtherMonth=1;
var nextIsOtherMonth=0;// 明天是下个月

window.onload=function(){
	initTable();
	showMonth(month);
	$("#sureHaveTaskDay_btn").removeAttr("disabled");
}


function chooseHaveTaskDay(loc){
	style=$("#td_"+loc).attr("class");
	dayNum=days[loc];
	
	if(style=="haveTask"){
		// 选中的日子之前有任务，当前反选
		$("#td_"+loc).attr("class","");
		haveTaskDays.splice($.inArray(dayNum,haveTaskDays),1);
	}else if(style=="" || style==undefined){
		// 新选中当前日子有任务
		$("#td_"+loc).attr("class","haveTask");
		haveTaskDays.push(dayNum);
	}
}


function sureHaveTaskDay(){
	name=$("#name").val();

	if(name==""){
		alert("请输入姓名/昵称！");
		$("#name").focus();
		return false;
	}

	$("#name_show").html(name);

	for(i=0;i<42;i++){
		// 清除日历单元格的onClick事件
		$("#td_"+i).attr("onclick","");
	}

	// 显示邀请词和二维码
	$("#invite").attr("style","text-align: center;");
	$("#qrcode").attr("style","");

	// 修改确认按钮样式
	$("#name").attr("disabled","disabled");
	$("#sureHaveTaskDay_btn").attr("disabled","disabled");
	$("#sureHaveTaskDay_btn").attr("class","am-btn am-btn-default");

	alert("您已成功确定有任务的日子。\n系统正在生成照片，请稍后！");

	// 生成日历照片
	event.preventDefault();
	html2canvas(document.getElementById("calendar"), {
		allowTaint: true,
		taintTest: false,
		onrendered:function(canvas){
			canvas.id = "mycanvas";
			//生成base64图片数据
			var dataUrl = canvas.toDataURL();
			var newImg = document.createElement("img");
			newImg.src =  dataUrl;
			document.body.appendChild(newImg);
		}
	});

	// 隐藏邀请词和二维码
	$("#invite").attr("style","display:none;text-align: center;");
	$("#qrcode").attr("style","display:none;");

	alert("生成成功！！！\n请长按下图以保存照片！");
}


function initTable(){
	content="";

	for(i=0;i<5;i++){
		content+="<tr>";

		for(j=0;j<7;j++){
			loc=i*7+j;
			
			// 获取日期数字
			dayNum=days[loc];
			lastDayNum=days[loc-1];
			nextDayNum=days[loc+1];

			// 月份单元格样式判断
			if(showOtherMonth==1 && dayNum>1){
				// 上个月的几天
				monthStyle=1;
			}else if(nextIsOtherMonth==1){
				// 今天是下个月
				monthStyle=1;
			}else if(nextDayNum<dayNum){
				// 明天是下个月
				nextIsOtherMonth=1;
				monthStyle=0;
			}else{
				// 这个月内
				showOtherMonth=0;
				monthStyle=0;
			}

			// 月份单元格样式显示
			if(monthStyle==1){
				content+='<td id="td_'+loc+'" class="otherMonth">';
			}else if(haveTaskDays.indexOf(dayNum)!=-1){
				content+='<td id="td_'+loc+'" class="haveTask" onclick="chooseHaveTaskDay('+loc+')">';
			}else if(date.getDate()==dayNum){
				content+='<td id="td_'+loc+'" class="today" onclick="chooseHaveTaskDay('+loc+')">';
			}else{
				content+='<td id="td_'+loc+'" onclick="chooseHaveTaskDay('+loc+')">';
			}

			content+=dayNum+"</td>";
		}

		content+="</tr>";
	}

	$("#table").append(content);
}


function showMonth(month){
	ret="";
	switch(month){
		case 1:
		ret="一月";
		break;
		case 2:
		ret="二月";
		break;
		case 3:
		ret="三月";
		break;
		case 4:
		ret="四月";
		break;
		case 5:
		ret="五月";
		break;
		case 6:
		ret="六月";
		break;
		case 7:
		ret="七月";
		break;
		case 8:
		ret="八月";
		break;
		case 9:
		ret="九月";
		break;
		case 10:
		ret="十月";
		break;
		case 11:
		ret="十一月";
		break;
		case 12:
		ret="十二月";
		break;
	}

	$("#month").html(ret);
}
</script>

</body>
</html>
